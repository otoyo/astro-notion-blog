---
import { ENABLE_LIGHTBOX } from '../server-constants';
import { getDatabase } from '../lib/notion/client';
import { getNavLink, getStaticFilePath, filePath } from '../lib/blog-helpers';

import '../styles/syntax-coloring.css';
import Navbar from '../components/Navbar.astro';
import HeroTelegram from '../components/HeroTelegram.astro';
import FeaturedNav from '../components/FeaturedNav.astro';

import FeaturedStat from '../components/FeaturedStat.astro';
import Testimonial from '../components/Testimonial.astro';
import FeaturedGeneral from '../components/FeaturedGeneral.astro';
import ClickToAction from '../components/ClickToAction.astro';
import Footer from '../components/Footer.astro';




export interface Props {
	title: string;
	description: string;
	path: string;
	ogImage: string;
}

const { title = '', description = '', path = '/', ogImage = '' } = Astro.props;

const database = await getDatabase();

const siteTitle = title ? `${title} - ${database.Title}` : database.Title;
const siteDescription = description ? description : database.Description;
const siteURL = new URL(getNavLink(path), Astro.site).toString();
const siteOGImage = new URL(getStaticFilePath('/og-image.webp'), Astro.site);

let customIconURL: string;
if (database.Icon && database.Icon.Type === 'file') {
	try {
		customIconURL = filePath(new URL(database.Icon.Url));
	} catch (err) {
		console.log('Invalid DB custom icon URL');
	}
}
---

<!doctype html>
<html lang="en">
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="robots" content="max-image-preview:large" />
		<meta charset="UTF-8" />
		<meta name="generator" content={Astro.generator} />
		<title>{siteTitle}</title>
		<meta name="description" content={siteDescription} />
		<link rel="canonical" href={siteURL} />
		<meta property="og:url" content={siteURL} />
		<meta property="og:title" content={siteTitle} />
		<meta property="og:description" content={siteDescription} />
		<meta property="og:site_name" content={database.Title} />
		<meta property="og:image" content={ogImage || siteOGImage} />
		<meta name="twitter:title" content={siteTitle} />
		<meta name="twitter:description" content={siteDescription} />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:image" content={ogImage || siteOGImage} />
		<link rel="manifest" href="/site.webmanifest" />
		<link rel="icon" type="image/x-icon" href="/favicon.ico" />
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
			integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0"
			crossorigin="anonymous"
		/>
		<link rel="preconnect" href="https://rsms.me/" />
		<link rel="stylesheet" href="https://rsms.me/inter/inter.css" />
	</head>
	<body>
		<div class="relative flex flex-col">
			<!-- header -->
			<Navbar />
			<!-- end header -->
      <div class="max-w-5xl w-full mx-auto"><slot name="main" /></div>
      <Footer />
			<!-- <div class="container mx-auto px-4">
				<main>
					<div class="content">
						<header>
							<h1>
								<a href={getNavLink('/')}>
									{
										database.Icon && database.Icon.Type === 'emoji' ? (
											<>
												<span>{database.Icon.Emoji}</span>
												{database.Title}
											</>
										) : database.Icon && database.Icon.Type === 'external' ? (
											<>
												<img src={database.Icon.Url} alt="Site icon image" />
												{database.Title}
											</>
										) : database.Icon && database.Icon.Type === 'file' ? (
											<>
												<img src={customIconURL} class="custom-icon" alt="Site icon image" />
												{database.Title}
											</>
										) : (
											database.Title
										)
									}
								</a>
							</h1>
							<div class="description">
								{database.Description}
							</div>
						</header>

						<slot name="main" />

						<footer>
							<div>
								<span>Powered by</span>
								<a href="https://github.com/otoyo/astro-notion-blog">astro-notion-blog</a>
							</div>
						</footer>
					</div>
				</main>

				<aside>
					<slot name="aside" />
				</aside>
			</div> -->
		</div>

		{ENABLE_LIGHTBOX && <script src={getStaticFilePath('/scripts/fslightbox.js')} />}
		<script src="https://cdn.jsdelivr.net/npm/@preline/preline@1.0.0/dist/hs-ui.bundle.min.js"
		></script>
	</body>
</html>

<style>
	main footer span {
		color: #777;
	}
	main footer a {
		color: inherit;
		text-decoration: underline;
	}
</style>

<style is:global>
	:root {
		--gap-quarter: 0.25rem;
		--gap-half: 0.5rem;
		--gap: 1rem;
		--gap-double: 2rem;

		--bg: #fff;
		--fg: color: rgb(82 82 91);;
		--accents-1: color: rgb(161 161 170);
		--accents-2: color: rgb(161 161 170);
		--accents-3: color: rgb(161 161 170);
		--geist-foreground: #000;
		--geist-success: #690;

		--radius: 4px;

		--font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu',
			'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
		--font-mono: SFMono-Regular, Menlo, Consolas, 'PT Mono', 'Liberation Mono', Courier, monospace;
	}

	* {
		box-sizing: border-box;
		word-break: break-word;
	}

	html,
	body {
		padding: 0;
		margin: 0;
		font-size: 16px;
	}
  .balance {
		text-wrap: balance;
	}

	body {
		min-height: 100vh;
		background: var(--bg);
		color: var(--fg);
		font-family:
			ui-sans-serif,
			-apple-system,
			BlinkMacSystemFont,
			'Segoe UI',
			Helvetica,
			Meiryo,
			'Apple Color Emoji',
			Arial,
			sans-serif,
			'Segoe UI Emoji',
			'Segoe UI Symbol';

		/*background-image: radial-gradient(#ddd 1px, transparent 1px),
      radial-gradient(#ddd 1px, transparent 1px);*/
		background-position:
			0 0,
			25px 25px;
		background-attachment: fixed;
		background-size: 50px 50px;

		/* Hack */
		overflow-x: hidden;

		-webkit-font-smoothing: antialiased;
		-webkit-text-size-adjust: 100%;
	}

	h1,
	h2,
	h3,
	h4,
	h5,
	h6 {
		font-family: 'Inter var', sans-serif;
	}

	figure {
		margin: 0;
		font-size: 0.85rem;
		color: #999;
		line-height: 1.8rem;
	}

	a {
		color: var(--accents-1);
		text-decoration: none;
	}
	a:hover {
		color: var(--accents-1);
	}

	mark {
		padding: var(--gap-quarter);
		border-radius: var(--radius);
		background: rgba(247, 212, 255, 0.8);
	}

	h1 {
		margin: 0;
		color: var(--fg);
		font-size: 2rem;
		font-weight: 700;
	}

	@media (max-width: 640px) {
		h1 {
			font-size: 1.6rem;
		}
	}

	ol {
		color: #222;
		font-weight: 400;
		font-size: 0.9rem;
		line-height: 1.8rem;
	}
	p,
	ul {
		color: #222;
		font-weight: 400;
		font-size: 1rem;
		line-height: 1.8rem;
	}
	ul,
	ol {
		margin: 0;
		padding-inline-start: 1.5rem;
	}
	pre {
		margin: 0;
		white-space: pre;
		tab-size: 2;
	}
	pre :global(code) {
		overflow: auto;
		-webkit-overflow-scrolling: touch;
	}

	hr {
		display: block;
		height: 1px;
		border: 0;
		margin: 0.3rem 0;
		background-color: #333;
	}

	code {
		font-size: 0.9rem;
		background: rgba(135, 131, 120, 0.15);
		color: #eb5757;
		padding: 0.25rem;
		border-radius: var(--radius);
		font-family: var(--font-mono);
	}

	table {
		display: block;
		overflow-x: auto;
		white-space: nowrap;
		border-collapse: collapse;
	}

	table tr {
		vertical-align: top;
	}

	table th {
		font-weight: 600;
		background-color: #f4f4f4;
	}

	table td,
	table th {
		font-size: 0.9rem;
		border: 1px solid #e4e4e4;
		padding: 0.5rem 1rem;
		text-align: left;
		line-height: 1.2rem;
	}
	table td::after {
		content: '';
		display: inline-block;
		min-height: 0.9rem;
	}
</style>
